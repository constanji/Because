# 查询格式化指南

本指南说明如何格式化用户查询和生成的 SQL，确保查询清晰、准确和易于理解。

## 用户查询格式化

### 基本要求

1. **清晰明确**：查询应该清晰明确，避免歧义
2. **完整信息**：包含所有必要的信息（表名、列名、条件等）
3. **自然语言**：使用自然的语言表达，不要使用 SQL 语法

### 好的查询示例

✅ **清晰明确**：
- "查询每个国家的病例总数"
- "显示最近一周的新增病例"
- "列出销售额排名前10的产品"

✅ **完整信息**：
- "查询2024年1月到3月每个月的销售额"
- "显示购买了产品A的所有客户"

✅ **自然语言**：
- "我想知道每个国家的病例总数"
- "能否帮我查询最近一周的数据？"

### 不好的查询示例

❌ **模糊不清**：
- "查一下数据"
- "那个表的信息"

❌ **信息不完整**：
- "查询总数"（缺少分组条件）
- "最近的数据"（缺少时间范围）

❌ **使用 SQL 语法**：
- "SELECT * FROM table"
- "查询 WHERE country = 'China'"

## SQL 格式化

### ANSI SQL 标准

生成的 SQL 必须符合 ANSI SQL 标准：

1. **标准语法**：使用标准的 SQL 语法，避免数据库特定特性
2. **表名和列名**：使用语义模型中定义的表名和列名
3. **大小写**：关键词使用大写（SELECT, FROM, WHERE 等）
4. **缩进**：适当缩进，提高可读性

### SQL 格式化示例

```sql
-- 好的格式化
SELECT 
    country,
    SUM(cases) AS total_cases
FROM 
    covid_data
WHERE 
    date >= '2024-01-01'
    AND date < '2024-02-01'
GROUP BY 
    country
ORDER BY 
    total_cases DESC;

-- 不好的格式化（缺少缩进）
SELECT country, SUM(cases) AS total_cases FROM covid_data WHERE date >= '2024-01-01' AND date < '2024-02-01' GROUP BY country ORDER BY total_cases DESC;
```

### SQL 格式化规则

1. **SELECT 子句**：
   - 每个字段占一行
   - 使用适当的缩进
   - 使用 AS 关键字定义别名

2. **FROM 子句**：
   - 单独一行
   - 表名清晰

3. **WHERE 子句**：
   - 每个条件单独一行
   - 使用适当的逻辑运算符（AND, OR）
   - 使用括号明确优先级

4. **GROUP BY 和 ORDER BY**：
   - 每个字段单独一行
   - 使用适当的排序方向（ASC, DESC）

## 查询优化建议

### 性能优化

1. **索引使用**：在 WHERE 和 JOIN 条件中使用索引字段
2. **限制结果集**：使用 LIMIT 限制返回的行数（如果适用）
3. **避免全表扫描**：确保 WHERE 条件使用索引字段

### 可读性优化

1. **清晰的别名**：使用有意义的表别名和列别名
2. **注释**：在复杂查询中添加注释说明
3. **格式化**：使用一致的缩进和换行

## 相关资源

- **SQL 规则指南**：`sql-rules-guide.md`
- **SQL 生成命令**：`../../commands/generate-sql.md`

---

**最后更新**：2025-01-27  
**版本**：1.0.0
